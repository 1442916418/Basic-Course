function addImage() {
    var spen_html = "<span class='bot' ></span>                         <span class='top'></span>";
    $(".blog_comment_body").append(spen_html);
    $(".blog_comment_body").before("<div class='body_right' style='float: left;'><a target='_blank'><img  /></a></div>");
    var feedbackCon = $(".feedbackCon").addClass("clearfix");
    for (var i = 0; i < feedbackCon.length; i++) {
        var span = $(feedbackCon[i]).find("span:last")[0].innerHTML || "http://pic.cnitblog.com/face/sample_face.gif";
        $(feedbackCon[i]).find(".body_right img").attr("src", span);
        var href = $(feedbackCon[i]).parent().find(".comment_date").next().attr("href");
        $(feedbackCon[i]).find(".body_right a").attr("href", href)
    }
}

function nextRecTop() {
    var rec = $("#RecentCommentsBlock");
    if (rec.length) {
        var top = rec.scrollTop();
        top++;
        rec.scrollTop(top);
        if (top != rec.scrollTop()) {
            rec.scrollTop(0)
        }
    }
}

function MobileComment() {
    var RecCommentTime = 80;
    var RecintervalId = setInterval(function() {
        nextRecTop()
    }, RecCommentTime);
    $("#RecentCommentsBlock").hover(function() {
        clearInterval(RecintervalId)
    }, function() {
        RecintervalId = setInterval(function() {
            nextRecTop()
        }, RecCommentTime)
    })
}

function addtbCommentBody_bg() {
    var tbcomment = $("#tbCommentBody");
    if (!tbcomment.hasClass("tbCommentBody_bg")) {
        tbcomment.addClass("tbCommentBody_bg");
        tbcomment.focus(function() {
            removetbCommentBody_bg()
        })
    }
}

function focusoutCommentBody_bg() {
    $("#tbCommentBody").focusout(function() {
        addtbCommentBody_bg()
    })
}

function removetbCommentBody_bg() {
    !$(".tbCommentBody_bg").removeClass("tbCommentBody_bg");
    $("#tbCommentBody").unbind("focus")
}
String.prototype.replaceAll = function(FindText, RepText) {
    regExp = new RegExp(FindText, "gm");
    return this.replace(regExp, RepText)
};

function resolveTitle(title) {
    var result;
    result = title.replaceAll(" ", "-");
    result = result.replaceAll("\\(", "");
    result = result.replaceAll("\\)", "");
    result = result.replaceAll("（", "");
    result = result.replaceAll("）", "");
    result = result.toLowerCase();
    return result
}

// 目录
function GenerateContentList() {
    var jquery_h3_list = $('#cnblogs_post_body h2');//如果你的章节标题不是h4,只需要将这里的h4换掉即可
    if(jquery_h3_list.length>0)
    {
        var content = '<a name="_labelTop"></a>';
        content    += '<div id="navCategory">';
        content    += '<p style="font-size:18px"><b>阅读目录</b></p>';
        content    += '<ul>';
        for(var i =0;i<jquery_h3_list.length;i++)
        {
            var go_to_top = '<div style="text-align: right"><a href="#_labelTop">回到顶部</a><a name="_label' + i + '"></a></div>';
            $(jquery_h3_list[i]).before(go_to_top);
            var li_content = '<li><a href="#_label' + i + '">' + $(jquery_h3_list[i]).text() + '</a></li>';
            content += li_content;
        }
        content    += '</ul>';
        content    += '</div>';
        if($('#cnblogs_post_body').length != 0 )
        {
            $($('#cnblogs_post_body')[0]).prepend(content);
        }
    }    
}

function generateTagClouds() {
    $(".catListTag>ul").wrap("<div class='wrap' ></div>").parent().css({
        "width": "240px",
        "height": "240px"
    });
    var options = {
        "range": [-200, 300],
        "gravity": -10,
        "xPos": 0.5,
        "yPos": 0.5,
        "gravityVector": [0, 0, 1],
        "interval": 100,
        "hoverGravityFactor": 0
    };
    $("div.wrap").starfieldTagCloud(options)
}

function customTimer(inpId, fn) {
    if ($(inpId).length) {
        fn()
    } else {
        var intervalId = setInterval(function() {
            if ($(inpId).length) {
                clearInterval(intervalId);
                customTimer(inpId, fn)
            }
        }, 100)
    }
}
$(function() {
    customTimer("#div_digg", function() {
        var div_html = "<div class=''>                        <a href='javascript:void(0);' onclick='c_follow();'>关注</a>                         &nbsp;|&nbsp;                        <a href='#top'>顶部</a>                         &nbsp;|&nbsp;                        <a href='javascript:void(0);' onclick=\" $('#tbCommentBody').focus();\">评论</a>                   </div>";
        $("#div_digg").append(div_html)
    });
    GenerateContentList();
    customTimer(".catListTag", generateTagClouds);
    MobileComment();
    customTimer(".blog_comment_body", addImage);
    customTimer("#tbCommentBody", function() {
        addtbCommentBody_bg();
        focusoutCommentBody_bg()
    })
});